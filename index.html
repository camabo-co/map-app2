<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>åº§æ¨™ãƒãƒƒãƒ—ç™»éŒ²ã‚¢ãƒ—ãƒªï¼ˆGoogleé€£æºï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body { font-family: sans-serif; font-size: 12px; margin: 10px; }
    #map { height: 800px; width: 800px; border: 1px solid #000; margin-top: 10px; }
    .popup { font-size: 11px; }
  </style>
</head>
<body>

<h2>ğŸ“ åº§æ¨™ãƒãƒƒãƒ—ç™»éŒ²ã‚¢ãƒ—ãƒªï¼ˆGoogleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé€£æºï¼‰</h2>
<p>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰åº§æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã€åœ°å›³ã«è¡¨ç¤ºã—ã¾ã™ã€‚</p>

<div id="map"></div>

<script>
  const SPREADSHEET_API_URL = "https://script.google.com/macros/s/AKfycbwWlWagyvdi8dyg_7OnnH6dgjbDRK-xyWeq9Eyt02O-0KaEAwuK9fPS9WtucC7bLiE/exec";

  const levelColors = {
    1: "red", 2: "orange", 3: "yellow",
    4: "green", 5: "blue", 6: "purple", 7: "black"
  };

  const map = L.map('map', {
    crs: L.CRS.Simple,
    minZoom: -1,
    maxZoom: 2
  });
  const bounds = [[0, 0], [1000, 1000]];
  L.rectangle(bounds, {color: "#ccc", weight: 1}).addTo(map);
  map.fitBounds(bounds);

  fetch(SPREADSHEET_API_URL)
    .then(res => res.json())
    .then(data => {
      data.forEach(item => {
        const x = Number(item["X"]);
        const y = Number(item["Y"]);
        const level = Number(item["ãƒ¬ãƒ™ãƒ«"]);
        const status = item["å–å¾—çŠ¶æ³"];
        const server = item["ã‚µãƒ¼ãƒãƒ¼å"] || item["ã‚µãƒ¼ãƒãƒ¼"];

        const color = (status === "å–å¾—æ¸ˆã¿" || status === "å–å¾—æ¸ˆ") ? "gray" : levelColors[level] || "black";

        const marker = L.circleMarker([1000 - y, x], {
          radius: 7,
          color: color,
          fillColor: color,
          fillOpacity: 0.8
        }).addTo(map).bindPopup(
          `<div class="popup">ğŸ—ºï¸ ã‚µãƒ¼ãƒãƒ¼: ${server}<br>X: ${x}, Y: ${y}<br>ãƒ¬ãƒ™ãƒ«: ${level}<br>çŠ¶æ…‹: ${status}</div>`
        );
      });
    })
    .catch(err => {
      alert("ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚URLã‚„å…¬é–‹è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      console.error(err);
    });
</script>

</body>
</html>
