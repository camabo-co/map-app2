{"name":"index_complete_fixed.html","type":"code/html","content":"<!DOCTYPE html>\n<html lang="ja">\n<head>\n <meta charset="UTF-8">\n <title>åº§æ¨™ãƒãƒƒãƒ—ã‚¢ãƒ—ãƒªï¼ˆå®Œå…¨ç‰ˆãƒ»ä¿®æ­£ç‰ˆï¼‰</title>\n <meta name="viewport" content="width=device-width, initial-scale=1">\n <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css\" />\n <script src="https://unpkg.com/leaflet/dist/leaflet.js\"></script>\n <style>\n body { font-family: sans-serif; font-size: 14px; margin: 10px; }\n #map { height: 600px; width: 100%; max-width: 800px; border: 1px solid #000; margin: 10px auto; }\n form, #filterArea, #listBtn { max-width: 800px; margin: 10px auto; }\n label, select, input { margin: 5px; font-size: 14px; }\n button { font-size: 14px; margin: 5px; }\n #listPopup {\n display: none;\n position: relative;\n background: #f9f9f9;\n padding: 10px;\n border: 1px solid #ccc;\n max-width: 800px;\n margin: 10px auto;\n max-height: 300px;\n overflow-y: auto;\n box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n }\n </style>\n</head>\n<body>\n\n<h2>ğŸ“ åº§æ¨™ãƒãƒƒãƒ—ã‚¢ãƒ—ãƒªï¼ˆGoogleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé€£æºãƒ»å®Œå…¨ç‰ˆï¼‰</h2>\n\n<form id="coordForm">\n <label>ã‚µãƒ¼ãƒãƒ¼å: <input type="text" id="server"></label>\n <label>X: <input type="number" id="x"></label>\n <label>Y: <input type="number" id="y"></label>\n <label>ãƒ¬ãƒ™ãƒ«:\n <select id="level">\n <option>1</option><option>2</option><option>3</option>\n <option>4</option><option>5</option><option>6</option><option>7</option>\n </select>\n </label>\n <label>çŠ¶æ…‹:\n <select id="status">\n <option>æœªå–å¾—</option>\n <option>å–å¾—æ¸ˆã¿</option>\n </select>\n </label>\n <button type="submit">ç™»éŒ²</button>\n</form>\n\n<div id="filterArea">\n <label>ãƒ¬ãƒ™ãƒ«:\n <select id="filterLevel">\n <option value="">ã™ã¹ã¦</option>\n <option>1</option><option>2</option><option>3</option>\n <option>4</option><option>5</option><option>6</option><option>7</option>\n </select>\n </label>\n <label>çŠ¶æ…‹:\n <select id="filterStatus">\n <option value="">ã™ã¹ã¦</option>\n <option>æœªå–å¾—</option>\n <option>å–å¾—æ¸ˆã¿</option>\n </select>\n </label>\n <button onclick="loadData()">ğŸ” çµã‚Šè¾¼ã¿è¡¨ç¤º</button>\n</div>\n\n<button id="listBtn" onclick="showList()">ğŸ“‹ ä¸€è¦§è¡¨ç¤º</button>\n\n<div id="listPopup">\n <button onclick="closeList()">âœ– é–‰ã˜ã‚‹</button>\n <div id="listContent"></div>\n</div>\n\n<div id="map"></div>\n\n<script>\nconst API_URL = "https://camabo-co.github.io/map-app2/";\nconst levelColors = {\n 1: "red", 2: "orange", 3: "yellow",\n 4: "green", 5: "blue", 6: "purple", 7: "black"\n};\nlet map = L.map('map', {\n crs: L.CRS.Simple,\n minZoom: -1,\n maxZoom: 2\n});\nlet bounds = [[0, 0], [1000, 1000]];\nL.rectangle(bounds, {color: "#ccc", weight: 1}).addTo(map);\nmap.fitBounds(bounds);\nlet markerLayer = L.layerGroup().addTo(map);\n\nfunction loadData() {\n markerLayer.clearLayers();\n fetch(API_URL)\n .then(res => res.json())\n .then(data => {\n const fLevel = document.getElementById('filterLevel').value;\n const fStatus = document.getElementById('filterStatus').value;\n window.latestData = data;\n data.forEach((item, idx) => {\n if ((fLevel && item["ãƒ¬ãƒ™ãƒ«"] != fLevel) || (fStatus && item["å–å¾—çŠ¶æ³"] != fStatus)) return;\n const x = Number(item["X"]);\n const y = Number(item["Y"]);\n const level = Number(item["ãƒ¬ãƒ™ãƒ«"]);\n const status = item["å–å¾—çŠ¶æ³"];\n const color = (status === "å–å¾—æ¸ˆã¿") ? "gray" : levelColors[level] || "black";\n\n const marker = L.circleMarker([1000 - y, x], {\n radius: 7,\n color: color,\n fillColor: color,\n fillOpacity: 0.9\n }).addTo(markerLayer).bindPopup(\n <b>${item[\"ã‚µãƒ¼ãƒãƒ¼å\"]}</b><br>X:${x} Y:${y}<br>Lv:${level}<br>${status}<br> +\n <button onclick='markObtained(${idx})'>âœ… å–å¾—æ¸ˆã¿ã«</button>\n );\n });\n });\n}\n\nfunction markObtained(idx) {\n const item = window.latestData[idx];\n item["å–å¾—çŠ¶æ³"] = "å–å¾—æ¸ˆã¿";\n fetch(API_URL, {\n method: 'POST',\n body: JSON.stringify(item)\n }).then(() => loadData());\n}\n\ndocument.getElementById('coordForm').addEventListener('submit', e => {\n e.preventDefault();\n const data = {\n "ã‚µãƒ¼ãƒãƒ¼å": document.getElementById('server').value,\n "X": document.getElementById('x').value,\n "Y": document.getElementById('y').value,\n "ãƒ¬ãƒ™ãƒ«": document.getElementById('level').value,\n "å–å¾—çŠ¶æ³": document.getElementById('status').value\n };\n fetch(API_URL, {\n method: 'POST',\n body: JSON.stringify(data)\n }).then(() => {\n alert("ç™»éŒ²å®Œäº†");\n loadData();\n });\n});\n\nfunction showList() {\n const popup = document.getElementById('listPopup');\n const content = document.getElementById('listContent');\n if (!window.latestData) return;\n let æœª = '', æ¸ˆ = '';\n window.latestData.forEach(d => {\n const row = ğŸ—ºï¸ ${d[\"ã‚µãƒ¼ãƒãƒ¼å\"]} / X:${d[\"X\"]}, Y:${d[\"Y\"]} / Lv:${d[\"ãƒ¬ãƒ™ãƒ«\"]}<br>;\n if (d["å–å¾—çŠ¶æ³"] === "å–å¾—æ¸ˆã¿") æ¸ˆ += row;\n else æœª += row;\n });\n content.innerHTML = <h4>ğŸŸ¢ æœªå–å¾—</h4>${æœª}<h4>âšª å–å¾—æ¸ˆã¿</h4>${æ¸ˆ};\n popup.style.display = 'block';\n}\n\nfunction closeList() {\n document.getElementById('listPopup').style.display = 'none';\n}\n\nloadData();\n</script>\n\n</body>\n</html>"}