{"name":"index_complete_fixed.html","type":"code/html","content":"<!DOCTYPE html>\n<html lang="ja">\n<head>\n <meta charset="UTF-8">\n <title>座標マップアプリ（完全版・修正版）</title>\n <meta name="viewport" content="width=device-width, initial-scale=1">\n <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css\" />\n <script src="https://unpkg.com/leaflet/dist/leaflet.js\"></script>\n <style>\n body { font-family: sans-serif; font-size: 14px; margin: 10px; }\n #map { height: 600px; width: 100%; max-width: 800px; border: 1px solid #000; margin: 10px auto; }\n form, #filterArea, #listBtn { max-width: 800px; margin: 10px auto; }\n label, select, input { margin: 5px; font-size: 14px; }\n button { font-size: 14px; margin: 5px; }\n #listPopup {\n display: none;\n position: relative;\n background: #f9f9f9;\n padding: 10px;\n border: 1px solid #ccc;\n max-width: 800px;\n margin: 10px auto;\n max-height: 300px;\n overflow-y: auto;\n box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n }\n </style>\n</head>\n<body>\n\n<h2>📍 座標マップアプリ（Googleスプレッドシート連携・完全版）</h2>\n\n<form id="coordForm">\n <label>サーバー名: <input type="text" id="server"></label>\n <label>X: <input type="number" id="x"></label>\n <label>Y: <input type="number" id="y"></label>\n <label>レベル:\n <select id="level">\n <option>1</option><option>2</option><option>3</option>\n <option>4</option><option>5</option><option>6</option><option>7</option>\n </select>\n </label>\n <label>状態:\n <select id="status">\n <option>未取得</option>\n <option>取得済み</option>\n </select>\n </label>\n <button type="submit">登録</button>\n</form>\n\n<div id="filterArea">\n <label>レベル:\n <select id="filterLevel">\n <option value="">すべて</option>\n <option>1</option><option>2</option><option>3</option>\n <option>4</option><option>5</option><option>6</option><option>7</option>\n </select>\n </label>\n <label>状態:\n <select id="filterStatus">\n <option value="">すべて</option>\n <option>未取得</option>\n <option>取得済み</option>\n </select>\n </label>\n <button onclick="loadData()">🔍 絞り込み表示</button>\n</div>\n\n<button id="listBtn" onclick="showList()">📋 一覧表示</button>\n\n<div id="listPopup">\n <button onclick="closeList()">✖ 閉じる</button>\n <div id="listContent"></div>\n</div>\n\n<div id="map"></div>\n\n<script>\nconst API_URL = "https://camabo-co.github.io/map-app2/";\nconst levelColors = {\n 1: "red", 2: "orange", 3: "yellow",\n 4: "green", 5: "blue", 6: "purple", 7: "black"\n};\nlet map = L.map('map', {\n crs: L.CRS.Simple,\n minZoom: -1,\n maxZoom: 2\n});\nlet bounds = [[0, 0], [1000, 1000]];\nL.rectangle(bounds, {color: "#ccc", weight: 1}).addTo(map);\nmap.fitBounds(bounds);\nlet markerLayer = L.layerGroup().addTo(map);\n\nfunction loadData() {\n markerLayer.clearLayers();\n fetch(API_URL)\n .then(res => res.json())\n .then(data => {\n const fLevel = document.getElementById('filterLevel').value;\n const fStatus = document.getElementById('filterStatus').value;\n window.latestData = data;\n data.forEach((item, idx) => {\n if ((fLevel && item["レベル"] != fLevel) || (fStatus && item["取得状況"] != fStatus)) return;\n const x = Number(item["X"]);\n const y = Number(item["Y"]);\n const level = Number(item["レベル"]);\n const status = item["取得状況"];\n const color = (status === "取得済み") ? "gray" : levelColors[level] || "black";\n\n const marker = L.circleMarker([1000 - y, x], {\n radius: 7,\n color: color,\n fillColor: color,\n fillOpacity: 0.9\n }).addTo(markerLayer).bindPopup(\n <b>${item[\"サーバー名\"]}</b><br>X:${x} Y:${y}<br>Lv:${level}<br>${status}<br> +\n <button onclick='markObtained(${idx})'>✅ 取得済みに</button>\n );\n });\n });\n}\n\nfunction markObtained(idx) {\n const item = window.latestData[idx];\n item["取得状況"] = "取得済み";\n fetch(API_URL, {\n method: 'POST',\n body: JSON.stringify(item)\n }).then(() => loadData());\n}\n\ndocument.getElementById('coordForm').addEventListener('submit', e => {\n e.preventDefault();\n const data = {\n "サーバー名": document.getElementById('server').value,\n "X": document.getElementById('x').value,\n "Y": document.getElementById('y').value,\n "レベル": document.getElementById('level').value,\n "取得状況": document.getElementById('status').value\n };\n fetch(API_URL, {\n method: 'POST',\n body: JSON.stringify(data)\n }).then(() => {\n alert("登録完了");\n loadData();\n });\n});\n\nfunction showList() {\n const popup = document.getElementById('listPopup');\n const content = document.getElementById('listContent');\n if (!window.latestData) return;\n let 未 = '', 済 = '';\n window.latestData.forEach(d => {\n const row = 🗺️ ${d[\"サーバー名\"]} / X:${d[\"X\"]}, Y:${d[\"Y\"]} / Lv:${d[\"レベル\"]}<br>;\n if (d["取得状況"] === "取得済み") 済 += row;\n else 未 += row;\n });\n content.innerHTML = <h4>🟢 未取得</h4>${未}<h4>⚪ 取得済み</h4>${済};\n popup.style.display = 'block';\n}\n\nfunction closeList() {\n document.getElementById('listPopup').style.display = 'none';\n}\n\nloadData();\n</script>\n\n</body>\n</html>"}